<table class="layui-hide" id="mainTable" lay-filter="mainTable"></table>
<!--templet start-->
<script type="text/html" id="orderIdTpl">
    <a href='javascript:ShowGoodsModel()' class="layui-table-link"><strong>{{ d.orderId }}</strong></a>
</script>

<script type="text/html" id="dayTpl">
    <strong>{{ d.day >= 3 ? '<span style="color: red">'+d.day+'</span>' : d.day }}</strong>
</script>

<script type="text/html" id="switchTplForWuliu">
    <input type="checkbox" id="wuliu" name="wuliu" value='{{d.uin}}' lay-skin="switch" lay-text="是|否"
           lay-filter="wuliuDome" {{ d.isArrive== 1 ? 'checked' : '' }}>
</script>

<script type="text/html" id="switchTplForComment">

    <input type="checkbox" id="comment" name="comment" value="{{d.uin}}" lay-skin="switch" lay-text="是|否"
           lay-filter="commentDome" {{ d.isComment== 1 ? 'checked' : '' }}>
</script>
<!--templet end-->
<script>
    function ShowGoodsModel(){
        debugger;
        //TODO 显示商品模块
        layer.open({
            type: 1
            ,title: false //不显示标题栏
            ,closeBtn: false
            ,area: '300px;'
            ,shade: 0.8
            ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
            ,btn: ['火速围观', '残忍拒绝']
            ,btnAlign: 'c'
            ,moveType: 1 //拖拽模式，0或者1
            ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">你知道吗？亲！<br>layer ≠ layui<br><br>layer只是作为Layui的一个弹层模块，由于其用户基数较大，所以常常会有人以为layui是layerui<br><br>layer虽然已被 Layui 收编为内置的弹层模块，但仍然会作为一个独立组件全力维护、升级。<br><br>我们此后的征途是星辰大海 ^_^</div>'
            ,success: function(layero){
                var btn = layero.find('.layui-layer-btn');
                btn.find('.layui-layer-btn0').attr({
                    href: 'http://www.layui.com/'
                    ,target: '_blank'
                });
            }
        });
    }

    layui.use('table', function () {
        var table = layui.table
            , form = layui.form;

        table.render({
            elem: '#mainTable'
            , url: '/api/admin'
            , cellMinWidth: 80
            , parseData: function (res) { //res 即为原始返回的数据
                console.log(res)
                return {
                    "code": res.code, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.count, //解析数据长度
                    "data": res.data //解析数据列表
                };
            }
            , method: 'post'
            , cols: [[
                {type: 'numbers'}
                , {field: 'userName', title: '用户名'}
                , {field: 'orderId', title: '订单编号',  templet: '#orderIdTpl'}
                , {field: 'addTime', title: '购买时间', sort: true}
                , {field: 'day', title: '已购买天数', width: 300, sort: true, templet: '#dayTpl'}
                , {
                    field: 'isArrive',
                    title: '物流是否到达',
                    width: 120,
                    templet: '#switchTplForWuliu',
                    unresize: true,
                    align: 'center',
                }
                , {
                    field: 'isComment',
                    title: '是否评论',
                    width: 110,
                    templet: '#switchTplForComment',
                    unresize: true,
                    align: 'center',
                }
            ]]
            , page: true
            , request: {
                pageName: 'page' // 页码的参数名称，默认：page
                , limitName: 'size' //每页数据量的参数名，默认：limit
            }
        });
        //监听性别操作
        form.on('switch(wuliuDome)', function (obj) {
            var state = obj.elem.checked ? 1 : 0;
            var data = state + "_" + this.value;
            $.ajax({
                url: "api/updateState/IsArrive/" + data
                , type: 'get'
                , async: false
                , error: function (error) {
                    console.log(error)
                }
            })
        });

        //监听性别操作
        form.on('switch(commentDome)', function (obj) {
            var state = obj.elem.checked ? 1 : 0;
            var data = state + "_" + this.value;
            $.ajax({
                url: "api/updateState/IsComment/" + data
                , type: 'get'
                , async: false
                , error: function (error) {
                    console.log(error)
                }
            })
        });
        //监听行单击事件（双击事件为：rowDouble）
        table.on('row(mainTable)', function (obj) {
            //标注选中样式
            obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
        });
    });
</script>
